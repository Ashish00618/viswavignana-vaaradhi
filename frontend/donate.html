<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donate - Support Our Mission - Viswa Vignana Vaaradhi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-tilt/1.7.0/vanilla-tilt.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <style>
        body { font-family: 'Poppins', sans-serif; overflow-x: hidden; }
        
        /* Background Animation */
        .animated-bg {
            background: linear-gradient(135deg, #0f766e, #0D9488, #0f172a);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            position: relative;
        }
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Glassmorphism Container */
        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        /* Modern Input Fields */
        .modern-input {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s ease;
        }
        .modern-input:focus {
            background: rgba(0, 0, 0, 0.4);
            border-color: #2DD4BF; /* Bright Teal */
            box-shadow: 0 0 15px rgba(45, 212, 191, 0.4);
            outline: none;
        }
        .modern-input::placeholder { color: rgba(255, 255, 255, 0.5); }
        
        /* Custom Scrollbar */
        select option { background-color: #1f2937; color: white; }

        /* Animations */
        .fade-in-up { animation: fadeInUp 0.8s ease-out forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

        /* Navigation & Footer overrides */
        .nav-link { transition: all 0.3s ease; }
        .nav-link:hover { transform: scale(1.1); color: #FEFCE8; text-shadow: 0 0 10px rgba(253, 230, 138, 0.6); }
        
        .btn-glow {
            background: linear-gradient(90deg, #0D9488, #2DD4BF);
            position: relative;
            z-index: 1;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .btn-glow:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(45, 212, 191, 0.6);
        }
        
        /* Dropdown */
        .dropdown { position: relative; }
        .dropdown-content { display: none; position: absolute; background-color: rgba(13, 148, 136, 0.95); backdrop-filter: blur(10px); min-width: 220px; box-shadow: 0 8px 16px rgba(0,0,0,0.3); z-index: 50; top: 100%; left: 0; border-radius: 0.5rem; border: 1px solid rgba(255,255,255,0.1); }
        .dropdown-content a { color: white; padding: 12px 16px; text-decoration: none; display: block; transition: background 0.3s; }
        .dropdown-content a:hover { background-color: rgba(255,255,255,0.1); padding-left: 20px; }
        .dropdown:hover .dropdown-content { display: block; }

        /* Scroll to Top */
        #scrollToTopBtn { display: none; position: fixed; bottom: 30px; right: 30px; background: linear-gradient(to right, #2DD4BF, #F59E0B); color: white; padding: 12px 16px; border-radius: 50%; box-shadow: 0 0 15px rgba(45, 212, 191, 0.6); z-index: 1000; transition: all 0.3s; }
        #scrollToTopBtn:hover { transform: scale(1.1); box-shadow: 0 0 25px rgba(245, 158, 11, 0.8); }
    </style>
</head>
<body class="bg-gray-900 text-gray-100">

    <header class="bg-[#0D9488] bg-opacity-90 backdrop-blur-md text-white p-4 sticky top-0 z-50 shadow-lg border-b border-white/10">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <img src="/images/logo.png" alt="Logo" class="h-10 w-10 rounded-full shadow-lg border-2 border-white/30">
                <h2 class="text-2xl font-bold tracking-wide">Viswa Vignana Vaaradhi</h2>
            </div>
            <nav class="hidden md:flex items-center space-x-6 font-medium">
                <a href="index.html" class="nav-link">Home</a>
                <a href="about.html" class="nav-link">About</a>
                <a href="get-involved.html" class="nav-link">Get Involved</a>
                <div class="dropdown">
                    <a href="our-work.html" class="nav-link cursor-pointer">Our Work <i class="fas fa-chevron-down text-xs ml-1"></i></a>
                    <div class="dropdown-content">
                        <a href="education.html">Mission Medha (Education)</a>
                        <a href="political-legal-literacy.html">Nyaya Sadan (Legal)</a>
                        <a href="rural-development.html">Mission Trupthi (Hunger)</a>
                        <a href="agriculture.html">Mission Mano Swastya (Mental Health)</a>
                        <a href="health.html">Mission Jeeva Dhara (Agriculture)</a>
                    </div>
                </div>
                <a href="gallery.html" class="nav-link">Gallery</a>
                <a href="contact.html" class="nav-link">Contact</a>
                <a href="donate.html" class="bg-white text-[#0D9488] px-5 py-2 rounded-full font-bold hover:bg-[#FEFCE8] transition shadow-lg">Donate Now</a>
            </nav>
        </div>
    </header>

    <section class="animated-bg min-h-screen flex items-center justify-center py-20 px-4 relative">
        <div id="particles-js" class="absolute inset-0 z-0"></div>
        
        <div class="container mx-auto relative z-10 flex flex-col items-center">
            
            <div class="text-center mb-12 fade-in-up" style="animation-delay: 0.1s;">
                <h1 class="text-5xl md:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-[#2DD4BF] to-[#F59E0B] drop-shadow-sm mb-4">
                    Power the Change
                </h1>
                <p class="text-lg md:text-xl text-gray-200 max-w-2xl mx-auto">
                    Your contribution fuels our 5 missions. Every rupee creates a ripple of hope in rural India.
                </p>
            </div>

            <div class="w-full max-w-4xl grid grid-cols-1 md:grid-cols-5 gap-0 glass-panel fade-in-up tilt-element" style="animation-delay: 0.3s;">
                
                <div class="md:col-span-2 bg-[#0D9488]/40 p-8 flex flex-col justify-between border-r border-white/10 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-b from-transparent to-black/30 pointer-events-none"></div>
                    <div class="relative z-10">
                        <h3 class="text-2xl font-bold text-white mb-6">Why Donate?</h3>
                        <ul class="space-y-4 text-gray-100 text-sm">
                            <li class="flex items-start"><i class="fas fa-check-circle text-[#F59E0B] mt-1 mr-3"></i> <span><strong>Tax Benefits:</strong> Get 80G tax exemption certificate.</span></li>
                            <li class="flex items-start"><i class="fas fa-check-circle text-[#F59E0B] mt-1 mr-3"></i> <span><strong>Transparency:</strong> Regular updates on how your funds are used.</span></li>
                            <li class="flex items-start"><i class="fas fa-check-circle text-[#F59E0B] mt-1 mr-3"></i> <span><strong>Direct Impact:</strong> Funds go directly to field projects.</span></li>
                        </ul>
                    </div>
                    <div class="relative z-10 mt-8">
                        <div class="text-center p-4 bg-white/10 rounded-xl backdrop-blur-sm border border-white/10">
                            <i class="fas fa-heart text-3xl text-red-400 mb-2"></i>
                            <p class="text-sm font-light">"We make a living by what we get, but we make a life by what we give."</p>
                        </div>
                    </div>
                </div>

                <div class="md:col-span-3 p-8 relative">
                    <div id="donationFormSection">
                        <h3 class="text-2xl font-bold text-white mb-6 flex items-center">
                            <span class="bg-[#F59E0B] w-2 h-8 mr-3 rounded-full"></span> Make a Donation
                        </h3>
                        
                        <div class="space-y-5">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                                <div>
                                    <label for="name" class="text-sm text-gray-300 ml-1">Full Name</label>
                                    <input type="text" id="name" class="modern-input w-full rounded-lg" placeholder="John Doe" required>
                                </div>
                                <div>
                                    <label for="phone" class="text-sm text-gray-300 ml-1">Phone</label>
                                    <input type="tel" id="phone" class="modern-input w-full rounded-lg" placeholder="9876543210" required pattern="[0-9]{10}">
                                </div>
                            </div>

                            <div>
                                <label for="email" class="text-sm text-gray-300 ml-1">Email Address</label>
                                <input type="email" id="email" class="modern-input w-full rounded-lg" placeholder="john@example.com" required>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                                <div>
                                    <label for="amount" class="text-sm text-gray-300 ml-1">Amount (₹)</label>
                                    <input type="number" id="amount" class="modern-input w-full rounded-lg" placeholder="₹ 500" min="1" required>
                                </div>
                                <div>
                                    <label for="purpose" class="text-sm text-gray-300 ml-1">Purpose</label>
                                    <select id="purpose" class="modern-input w-full rounded-lg cursor-pointer">
                                        <option value="General Support">General Support</option>
                                        <option value="Mission Medha (Education)">Mission Medha (Education)</option>
                                        <option value="Nyaya Sadan (Legal Aid)">Nyaya Sadan (Legal Aid)</option>
                                        <option value="Mission Trupthi (Hunger)">Mission Trupthi (Hunger)</option>
                                        <option value="Mission Mano Swastya">Mission Mano Swastya</option>
                                        <option value="Mission Jeeva Dhara">Mission Jeeva Dhara</option>
                                    </select>
                                </div>
                            </div>

                            <div>
                                <label for="payment-method" class="text-sm text-gray-300 ml-1">Payment Method</label>
                                <div class="relative">
                                    <select id="payment-method" class="modern-input w-full rounded-lg cursor-pointer appearance-none" required>
                                        <option value="" disabled selected>Select Method</option>
                                        <option value="upi">UPI (GPay, PhonePe, Paytm)</option>
                                        <option value="bank">Direct Bank Transfer</option>
                                    </select>
                                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-300">
                                        <i class="fas fa-chevron-down text-xs"></i>
                                    </div>
                                </div>
                            </div>

                            <button id="proceedButton" class="btn-glow w-full py-3 rounded-xl text-white font-bold text-lg shadow-lg mt-4 tracking-wide">
                                Proceed to Pay <i class="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>

                    <div id="payment-details" class="hidden h-full flex flex-col">
                        <div class="flex items-center justify-between mb-6">
                            <h3 id="payment-title" class="text-2xl font-bold text-white">Payment Details</h3>
                            <button id="backButton" class="text-sm text-gray-400 hover:text-white"><i class="fas fa-arrow-left mr-1"></i> Back</button>
                        </div>
                        
                        <div class="bg-white/5 p-4 rounded-lg mb-6 border border-white/10 text-sm">
                            <div class="grid grid-cols-2 gap-2">
                                <span class="text-gray-400">Donor:</span> <span id="donor-name" class="text-white font-medium text-right"></span>
                                <span class="text-gray-400">Amount:</span> <span class="text-[#F59E0B] font-bold text-right">₹<span id="donor-amount"></span></span>
                                <span class="text-gray-400">Purpose:</span> <span id="donor-purpose" class="text-white text-right"></span>
                            </div>
                            <span id="donor-email" class="hidden"></span>
                            <span id="donor-phone" class="hidden"></span>
                        </div>

                        <div id="payment-content" class="text-center text-white flex-grow flex flex-col justify-center items-center">
                            </div>

                        <p class="text-xs text-gray-400 text-center mt-4">
                            <i class="fas fa-info-circle mr-1"></i> Important: After payment, click "Submit Record" to generate your receipt.
                        </p>

                        <button id="submitButton" class="btn-glow w-full py-3 rounded-xl text-white font-bold text-lg shadow-lg mt-4 tracking-wide">
                            Confirm & Submit Record
                        </button>
                    </div>

                    <div id="thankYouMessage" class="hidden h-full flex flex-col justify-center items-center text-center p-4">
                        <div class="w-20 h-20 bg-green-500/20 rounded-full flex items-center justify-center mb-6">
                            <i class="fas fa-check text-4xl text-green-400"></i>
                        </div>
                        <h3 class="text-3xl font-bold text-white mb-2">Thank You!</h3>
                        <p class="text-gray-300 mb-6">
                            <span id="thankyou-name" class="font-bold text-white"></span>, your generous donation of <span class="text-[#F59E0B] font-bold">₹<span id="thankyou-amount"></span></span> has been recorded.
                        </p>
                        <div class="bg-blue-500/10 border border-blue-500/30 p-4 rounded-lg text-sm text-blue-100">
                            Please email your payment screenshot to <br>
                            <a href="mailto:viswavignanavaaradhi@gmail.com" class="underline font-bold">viswavignanavaaradhi@gmail.com</a>
                        </div>
                        <button onclick="location.reload()" class="mt-8 text-gray-400 hover:text-white text-sm underline">Make another donation</button>
                    </div>

                </div>
            </div>
        </div>
    </section>

    <footer class="bg-[#0D9488] text-white p-10 border-t border-white/10">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-2xl font-bold mb-4">Viswa Vignana Vaaradhi</h3>
                    <p class="text-gray-100 text-sm leading-relaxed">We are a not-for-profit organization committed to improving lives through education, political awareness, and agricultural upliftment.</p>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Quick Links</h3>
                    <ul class="space-y-2 text-sm text-gray-100">
                        <li><a href="index.html" class="hover:text-[#F59E0B] transition">Home</a></li>
                        <li><a href="about.html" class="hover:text-[#F59E0B] transition">About</a></li>
                        <li><a href="our-work.html" class="hover:text-[#F59E0B] transition">Our Work</a></li>
                        <li><a href="contact.html" class="hover:text-[#F59E0B] transition">Contact</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Contact Us</h3>
                    <p class="text-sm text-gray-100 mb-2"><i class="fas fa-envelope mr-2"></i> viswavignanavaaradhi@gmail.com</p>
                    <p class="text-sm text-gray-100 mb-2"><i class="fas fa-phone mr-2"></i> +91-9010937358</p>
                    <p class="text-sm text-gray-100"><i class="fas fa-map-marker-alt mr-2"></i> Visakhapatnam, Andhra Pradesh</p>
                </div>
            </div>
            <div class="mt-10 pt-6 border-t border-white/20 text-center text-sm text-gray-200">
                <p>© 2025 Viswa Vignana Vaaradhi. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <button id="scrollToTopBtn" title="Go to top"><i class="fas fa-arrow-up"></i></button>

    <script>
        // Particles and Animations
        document.addEventListener('DOMContentLoaded', () => {
            // Init Particles
            if(typeof particlesJS !== 'undefined') {
                particlesJS('particles-js', {
                    particles: { number: { value: 80 }, color: { value: '#2DD4BF' }, shape: { type: 'circle' }, opacity: { value: 0.3, random: true }, size: { value: 3, random: true }, line_linked: { enable: true, distance: 150, color: '#2DD4BF', opacity: 0.2, width: 1 }, move: { enable: true, speed: 1 } },
                    interactivity: { detect_on: 'canvas', events: { onhover: { enable: true, mode: 'repulse' } } }
                });
            }
            
            // Init Tilt
            if(typeof VanillaTilt !== 'undefined') {
                VanillaTilt.init(document.querySelector(".tilt-element"), { max: 5, speed: 400, glare: true, "max-glare": 0.2 });
            }

            // Scroll to Top
            const scrollToTopBtn = document.getElementById('scrollToTopBtn');
            window.onscroll = function () {
                if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) { scrollToTopBtn.style.display = 'block'; } else { scrollToTopBtn.style.display = 'none'; }
            };
            scrollToTopBtn.addEventListener('click', () => { window.scrollTo({ top: 0, behavior: 'smooth' }); });

            // --- Form Logic (CORRECTED & ROBUST) ---
            const proceedButton = document.getElementById('proceedButton');
            const backButton = document.getElementById('backButton');
            const paymentDetails = document.getElementById('payment-details');
            const paymentTitle = document.getElementById('payment-title');
            const paymentContent = document.getElementById('payment-content');
            const donationFormSection = document.getElementById('donationFormSection');
            const submitButton = document.getElementById('submitButton');
            const thankYouMessage = document.getElementById('thankYouMessage');
            
            // Summary Spans
            const donorNameSpan = document.getElementById('donor-name');
            const donorAmountSpan = document.getElementById('donor-amount');
            const donorPurposeSpan = document.getElementById('donor-purpose');
            const donorEmailSpan = document.getElementById('donor-email');
            const donorPhoneSpan = document.getElementById('donor-phone');

            // Input Fields
            const nameInput = document.getElementById('name');
            const emailInput = document.getElementById('email');
            const phoneInput = document.getElementById('phone');
            const amountInput = document.getElementById('amount');
            const purposeInput = document.getElementById('purpose');
            const paymentMethodInput = document.getElementById('payment-method');

            // --- PROCEED CLICK ---
            proceedButton.addEventListener('click', () => {
                // Validation
                if (!nameInput.value || !emailInput.value || !phoneInput.value || !amountInput.value || !paymentMethodInput.value) {
                    alert('Please fill in all required fields.');
                    return;
                }
                if (!/^\d{10}$/.test(phoneInput.value)) {
                    alert('Please enter a valid 10-digit phone number.');
                    return;
                }

                // Populate Summary
                donorNameSpan.textContent = nameInput.value;
                donorEmailSpan.textContent = emailInput.value;
                donorPhoneSpan.textContent = phoneInput.value;
                donorAmountSpan.textContent = amountInput.value;
                donorPurposeSpan.textContent = purposeInput.value || 'General Support';

                // Render Payment Info
                if (paymentMethodInput.value === 'upi') {
                    paymentTitle.textContent = 'Pay via UPI';
                    paymentContent.innerHTML = `
                        <div class="bg-white p-3 rounded-xl inline-block mb-4">
                            <img src="/images/upi-qr-code.png" alt="UPI QR Code" class="w-40 h-40 object-contain">
                        </div>
                        <p class="text-lg">Scan to pay <strong class="text-[#F59E0B]">₹${amountInput.value}</strong></p>
                        <p class="text-gray-300 font-mono bg-black/30 p-2 rounded mt-2 inline-block">viswavignanavaaradhi@upi</p>
                    `;
                } else {
                    paymentTitle.textContent = 'Bank Transfer';
                    paymentContent.innerHTML = `
                        <div class="bg-black/30 p-6 rounded-xl text-left inline-block w-full border border-white/10">
                            <p class="mb-2 text-gray-300 text-xs uppercase tracking-widest">Account Details</p>
                            <p class="mb-1"><span class="text-gray-400">Name:</span> <strong class="text-white ml-2">Viswa Vignana Vaaradhi Welfare Society</strong></p>
                            <p class="mb-1"><span class="text-gray-400">Account:</span> <strong class="text-white ml-2 font-mono">42087404874</strong></p>
                            <p class="mb-1"><span class="text-gray-400">IFSC:</span> <strong class="text-white ml-2 font-mono">SBIN0000772</strong></p>
                            <p class="mb-0"><span class="text-gray-400">Bank:</span> <strong class="text-white ml-2">SBI, AU Campus-VSP</strong></p>
                        </div>
                    `;
                }

                // Transition
                donationFormSection.classList.add('hidden');
                paymentDetails.classList.remove('hidden');
                paymentDetails.classList.add('fade-in-up');
            });

            // --- BACK CLICK ---
            backButton.addEventListener('click', () => {
                paymentDetails.classList.add('hidden');
                donationFormSection.classList.remove('hidden');
                donationFormSection.classList.add('fade-in-up');
            });

            // --- SUBMIT CLICK (THE FIX) ---
            submitButton.addEventListener('click', async () => {
                submitButton.disabled = true;
                submitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Processing...';

                // Data Object - Reading DIRECTLY from inputs to ensure 'name' is sent correctly
                const data = {
                    name: nameInput.value.trim(), // This key matches the backend model
                    email: emailInput.value.trim(),
                    phone: phoneInput.value.trim(),
                    amount: parseFloat(amountInput.value),
                    purpose: purposeInput.value || 'General Support',
                    paymentMethod: paymentMethodInput.value,
                    date: new Date().toISOString()
                };

                try {
                    const response = await fetch('/api/donation', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });

                    const result = await response.json();

                    if (!response.ok) {
                        throw new Error(result.error || 'Submission failed');
                    }

                    // Success
                    document.getElementById('thankyou-name').textContent = data.name;
                    document.getElementById('thankyou-amount').textContent = data.amount;

                    paymentDetails.classList.add('hidden');
                    thankYouMessage.classList.remove('hidden');
                    thankYouMessage.classList.add('fade-in-up');

                } catch (error) {
                    console.error('Error:', error);
                    alert(`Error: ${error.message}`);
                    submitButton.disabled = false;
                    submitButton.innerHTML = 'Confirm & Submit Record';
                }
            });
        });
    </script>
</body>
</html>